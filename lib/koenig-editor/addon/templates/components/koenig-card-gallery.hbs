{{#koenig-card
    tagName="figure"
    class=(concat (kg-style "media-card") " koenig-breakout-wide")
    isSelected=isSelected
    isEditing=isEditing
    selectCard=(action selectCard)
    deselectCard=(action deselectCard)
    editCard=(action editCard)
    toolbar=toolbar
    hasEditMode=false
    addParagraphAfterCard=addParagraphAfterCard
    moveCursorToPrevSection=moveCursorToPrevSection
    moveCursorToNextSection=moveCursorToNextSection
    editor=editor
    as |card|
}}
    {{#gh-uploader
        files=files
        accept=imageMimeTypes
        extensions=imageExtensions
        onStart=(action "insertImagePreviews")
        onUploadSuccess=(action "insertImageIntoPayload")
        onUploadFailed=(action "uploadFailed")
        as |uploader|
    }}
        <div class="relative{{unless images " bg-whitegrey-l2"}}">
            <div class="flex flex-column">
                {{#each imageRows as |row|}}
                    <div class="flex flex-row">
                        {{#each row as |image|}}
                            <div style={{image.style}} class={{image.classes}}>
                                <img src={{or image.previewSrc image.src}} width={{image.width}} height={{image.height}} class="w-100 h-100 db">
                            </div>
                        {{/each}}
                    </div>
                {{/each}}
            </div>

            {{#if isDraggedOver}}
                <div class="absolute absolute--fill flex items-center bg-black-60 pe-none">
                    <span class="db center sans-serif fw7 f7 white">
                        Drop to replace image
                    </span>
                </div>
            {{else if (or uploader.isUploading (is-empty imageRows))}}
                <div class="relative miw-100 flex items-center {{if (is-empty imageRows) "kg-media-placeholder ba b--whitegrey" "absolute absolute--fill bg-white-50"}}">
                    {{#if isDraggedOver}}
                        <span class="db center sans-serif fw7 f7 middarkgrey">
                            Drop it like it's hot ðŸ”¥
                        </span>
                    {{else if uploader.isUploading}}
                        {{uploader.progressBar}}
                    {{else if (is-empty imageRows)}}
                        <button class="flex flex-column items-center center sans-serif fw4 f7 middarkgrey pa8 pt6 pb6 kg-image-button" onclick={{action "triggerFileDialog"}}>
                            {{svg-jar "summer" class="kg-placeholder-image-summer nudge-right--10"}}
                            <span class="mt2 midgrey">Click to select some images</span>
                        </button>
                    {{/if}}
                </div>
            {{/if}}
        </div>

        <div style="display:none">
            {{gh-file-input multiple=true action=uploader.setFiles accept=imageMimeTypes}}
        </div>
    {{/gh-uploader}}

    {{#if (or isSelected (clean-basic-html payload.caption))}}
        {{card.captionInput
            caption=payload.caption
            update=(action "updateCaption")
            placeholder="Type caption for gallery (optional)"
        }}
    {{/if}}
{{/koenig-card}}